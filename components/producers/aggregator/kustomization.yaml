# DO NOT EDIT. Code generated by:
# github.com/ocurity/dracon/bin/kustomize-component-generator.

apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
resources:
  - task.yaml
patches:
  - target:
      kind: Pipeline
    patch: |
      - path: /spec/workspaces/-
        op: add
        value:
          name: output
      - path: /spec/params/-
        op: add
        value:
          name: producer-aggregator-anchors
          type: array
          description: A list of tasks that this task depends on.
          default: []
      - path: /spec/tasks/-
        op: add
        value:
          name: producer-aggregator
          taskRef:
            name: producer-aggregator
          workspaces:
            - name: output
              workspace: output
          params:
            - name: producer-aggregator-anchors
              value:
                - $(params.producer-aggregator-anchors)
  - target:
      kind: Pipeline
      annotationSelector: v1.dracon.ocurity.com/has-source=true
    patch: |
      - path: /spec/tasks/-/params/-
        op: add
        value:
          name: anchors
          value:
            - $(tasks.source.results.anchor)
  - target:
      kind: Pipeline
      annotationSelector: v1.dracon.ocurity.com/has-producer-aggregator=true
    patch: |
      - path: /spec/tasks/-/params/-
        op: add
        value:
          name: anchors
          value:
            - $(tasks.enricher-aggregator.results.anchor)
  - target:
      kind: Task
      name: producer-aggregator
    patch: |
      - path: /spec/params/-
        op: add
        value:
          name: dracon_scan_id
          type: string
      - path: /spec/params/-
        op: add
        value:
          name: dracon_scan_start_time
          type: string
      - path: /spec/steps/0/env/-
        op: add
        value:
          name: DRACON_SCAN_TIME
          value: $(params.dracon_scan_start_time)
      - path: /spec/steps/0/env/-
        op: add
        value:
          name: DRACON_SCAN_ID
          value: $(params.dracon_scan_id)
      - path: /spec/steps/1/env/-
        op: add
        value:
          name: DRACON_SCAN_TIME
          value: $(params.dracon_scan_start_time)
      - path: /spec/steps/1/env/-
        op: add
        value:
          name: DRACON_SCAN_ID
          value: $(params.dracon_scan_id)
      - path: /spec/steps/2/env/-
        op: add
        value:
          name: DRACON_SCAN_TIME
          value: $(params.dracon_scan_start_time)
      - path: /spec/steps/2/env/-
        op: add
        value:
          name: DRACON_SCAN_ID
          value: $(params.dracon_scan_id)
  # - patch: |
  #     apiVersion: tekton.dev/v1beta1
  #     kind: Pipeline
  #     metadata:
  #       name: unused
  #     spec:
  #       tasks:
  #         - name: producer-aggregator
  #           params:
  #             - name: dracon_scan_id
  #               value: $(tasks.base.results.dracon-scan-id)
  #             - name: dracon_scan_start_time
  #               value: $(tasks.base.results.dracon-scan-start-time)
  #   target:
  #     kind: Pipeline
